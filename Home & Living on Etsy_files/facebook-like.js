!function(t,e){e.ExternalAccounts&&e.ExternalAccounts.loaded||(e.ExternalAccounts=e.ExternalAccounts||{},e.ExternalAccounts.loaded=!0,e.ExternalAccounts.LinkageType={User:"user",Shop:"shop"},e.ExternalAccounts.Providers={Facebook:"facebook",Twitter:"twitter"},e.ExternalAccounts.ShareTypes={FavoriteListing:"favorite_item"},t.extend(e.ExternalAccounts,function(){var n="/api/v2/ajax/external-account",i=function(n,i,a,o,l,c,h,d,p){c=c||{},h=r(h,n,i,a,o,!1,l),d=r(d,n,i,a,o,!0,!1),s(i,o);var f=t.extend({_nnc:e.csrf_nonce,external_account_type_name:o,owner_type_name:i},c);n&&(f.owner_id=n),l?f.external_account_id=a:f.method="DELETE",u(f,h,d,p)},r=function(t,n,i,r,s,a,o){var l;return l=a?"connected_accounts_link_error":o?"connected_accounts_link":"connected_accounts_unlink",function(n,r){var o={php_event_name:l,service:s,object_type:i,user_id:n.etsyUid};n.shopId&&(o.shop_id=n.shopId),a&&n.errorType&&(o.error_type=n.errorType),e.EventLogger.logEvent(o),t(n,r)}},s=function(t,n){if(a(n),!l(t,e.ExternalAccounts.LinkageType))throw new Error("Linkage for object type: "+t+" is not supported")},a=function(t){if(!l(t,e.ExternalAccounts.Providers))throw new Error("External type: "+t+" is not supported")},o=function(t){if(!l(t,e.ExternalAccounts.ShareTypes))throw new Error("Share type: "+t+" is not supported")},l=function(t,e){if(void 0==t||null==t)return!1;for(var n in e)if(e[n]==t)return!0;return!1},u=function(e,i,r,s,a){a=a?"/"+a:"",t.ajax({url:n+a,data:e,dataType:"json",type:"POST",success:function(t){var e=t.results;e.success?i(e,s):r(e,s)},error:function(t){r(t,s)}})},c=function(t,n,i,r,s,l,c,h){a(t),o(r),h=h||"POST";var d={_nnc:e.csrf_nonce,share_type:r,method:h};u(d,s,l,c,t+"/"+n+"/"+i+"/shares/")};return{connectAccounts:function(t,e,n,r,s,a,o,l){i(n,r,t,e,!0,o,s,a,l)},disconnectAccounts:function(t,e,n,r,s,a){i(e,n,null,t,!1,null,r,s,a)},checkAccountLinkedToUser:function(t,n,i,r,s){var a={_nnc:e.csrf_nonce,external_account_type_name:n};u(a,i,r,s,"account-linked-to-user/")},checkAccountIsValid:function(t,n,i,r,s,o){a(i);var l={_nnc:e.csrf_nonce,email:t.email||"",name:t.name||"",external_account_id:n,external_account_type_name:i};u(l,r,s,o,"is-valid/"+n)},setAccountShare:function(t,e,n,i,r,s,a){c(t,e,n,i,r,s,a)},deleteAccountShare:function(t,e,n,i,r,s,a){c(t,e,n,i,r,s,a,"DELETE")}}}()))}(window.jQuery||window.Zepto,window.Etsy),window.Etsy.loader.loaded("common/etsy.external-accounts.20140703190110.js"),function(t,e){e.Facebook&&e.Facebook.loaded||(e.Facebook=e.Facebook||{},e.Facebook.loaded=!0,t.extend(e.Facebook,function(){var n="en_US",i=t('meta[property="fb:app_id"]').attr("content"),r="facebook",s=["email"],a=!1,o="default",l=e.Facebook,u=null,c=function(e){var n=t(e).data("context");return n?n:o},h=function(t){return _.uniq(t).sort()},d=function(t){return h(t).join(",")};return{load:function(s){if(s=s||function(){},a)t(document).bind("facebook:load",function(t,e){s(e)});else if(l.isConnected())s(!0);else{a=!0,window.fbAsyncInit=function(){a=!1,FB.init({appId:i,status:!0,cookie:!0,xfbml:!0,oauth:!0,channelUrl:document.location.protocol+"//"+document.location.hostname+"/fb/channel.html"}),t(document).trigger("facebook:load",[!0]),t(document).unbind("facebook:load")},t(document).bind("facebook:load",function(t,e){s(e)});var o=t("#fb-root").attr("data-locale"),u="//connect.facebook.net/"+(o?o:n)+"/all.js";t.getScript(u),t(document).bind("facebook:connect",function(t,n,i,s){var a=c(n);i&&s?e.EventLogger.logEvent({php_event_name:"connected_accounts_oauth_accept",source:a,service:r,xauid:l.getUid(),perms:l.getPerms()}):e.EventLogger.logEvent({php_event_name:"connected_accounts_oauth_refuse",source:a,service:r,perms:l.getPerms()})})}},isConnected:function(){return"undefined"!=typeof window.FB},login:function(n,i){if(!l.isConnected())throw"Facebook sdk not loaded";n||u?n&&l.setPerms(n):l.extendDefaultPerms(),l.checkPermissions(function(n){n?t(document).trigger("facebook:connect",[i,!0,n]):(e.EventLogger.logEvent({php_event_name:"connected_accounts_oauth_open",source:c(i),service:r,perms:l.getPerms()}),FB.login(function(e){e.authResponse?l.checkPermissions(function(e){t(document).trigger("facebook:connect",[i,!0,e])}):t(document).trigger("facebook:connect",[i,!1,!1])},{scope:l.getPerms()}))})},isLoggedIn:function(t){if(!l.isConnected())throw"Facebook SDK not loaded";FB.getLoginStatus(function(e){var n=null!==e.authResponse;t&&t(n)})},logout:function(t){FB.logout(function(){t&&t()})},getAccessToken:function(){var t=FB.getAuthResponse();return t?t.accessToken:null},getUid:function(){var t=FB.getAuthResponse();return t?t.userID:null},eventSubscribe:function(t,e){FB.Event.subscribe(t,e)},getProfilePictureUrl:function(t,e){return"http://graph.facebook.com/"+(t||this.getUid())+"/picture?type="+(e||"large")},postToFeed:function(e,n,i,r){if(!l.isConnected())throw"Facebook sdk not loaded";if(!e)throw"Etsy.Facebook.postToFeed: link is a required argument";n=n||{},n=t.each(n,function(t,e){(null==e||void 0==e)&&delete n.key});var s={method:"feed",link:e};t.extend(s,n),FB.ui(s,function(t){t&&t.post_id?"function"==typeof i&&i(t):"function"==typeof r&&r(t)})},extendDefaultPerms:function(t){var e=[];return t&&(e=t.split(",")),e=e.concat(s),u=d(e)},setPerms:function(t){var e=[];return t&&(e=t.split(",")),u=d(e)},getPerms:function(){return u},getDefaultPerms:function(){return s},reset:function(){a=!1,o="default",u=null},checkPermissions:function(e,n){var i,r=!1;l.isLoggedIn(function(s){return s?(n?n=h(n):(i=l.getPerms(),i||(i=l.extendDefaultPerms()),n=i.split(",")),!n||n.length<1?(r=!0,e.apply(l,[r])):(FB.api("/me/permissions",function(i){if(!i.error&&i.data&&i.data.length){var s=i.data[0];t.each(n,function(t,e){return r="undefined"!=typeof s[e]})}e.apply(l,[r])}),void 0)):e.apply(l,[r])})},setContext:function(t){o=t}}}()),t.extend(e.Facebook,function(){var n=700,i=5,r=e.Facebook,s=function(t,a){a=a||0,null!==FB.getAuthResponse()?a>=i?(e.Logger.error("Could not reset Facebook JS SDK after "+i+" attempts.",FB.getAuthResponse()),t.apply(r,[!1])):(a++,setTimeout(function(){FB.init(),s(t,a)},n*a)):t.apply(r,[!0])},a=function(n){t(document).trigger("facebook:account-disconnect-begin"),e.ExternalAccounts.disconnectAccounts(e.ExternalAccounts.Providers.Facebook,null,e.ExternalAccounts.LinkageType.User,function(){s(function(){t(document).trigger("facebook:account-disconnect",[n,!0])})},function(){t(document).trigger("facebook:account-disconnect",[n,!1])})},o=function(t,n,i,s){var a=e.ExternalAccounts.Providers.Facebook,o=e.ExternalAccounts.LinkageType.User,l=r.getUid();n?e.ExternalAccounts.setAccountShare(a,l,o,t,i,s):e.ExternalAccounts.deleteAccountShare(a,l,o,t,i,s)};return{initLoginButton:function(e,n){e&&("object"!=typeof e||e.length)&&(t(e).bind("click",function(t){t.preventDefault(),r.login(n,e)}),t(e).trigger("facebook:connect-button-active"))},initConnectButton:function(n,i,s,a){n&&("object"!=typeof n||n.length)&&("undefined"==typeof i&&(i=!0),a=a||"",s=s||{},t(n).bind("click",function(o){o.preventDefault(),i&&t(document).one("facebook:connect",function(i,a,o,l){if(o&&l&&(e.Mobile&&"undefined"!=typeof e.Mobile.isSignedIn?e.Mobile.isSignedIn:e.isSignedIn())){var u=[n];e.ExternalAccounts.connectAccounts(r.getUid(),e.ExternalAccounts.Providers.Facebook,null,e.ExternalAccounts.LinkageType.User,function(){t(document).trigger("facebook:account-connect",t.merge(u,arguments))},function(){t(document).trigger("facebook:account-connect-error",t.merge(u,arguments))},s)}}),r.extendDefaultPerms(a),r.login(r.getPerms(),n)}),t(n).trigger("facebook:connect-button-active"))},initDisconnectButton:function(e){t(e).bind("click",function(t){t.preventDefault(),a(e)})},accountConnected:function(t){e.ExternalAccounts.checkAccountLinkedToUser(r.getUid(),e.ExternalAccounts.Providers.Facebook,function(e){e.success?t.apply(null,[e.linked]):t.apply(null,[!1])},function(){t.apply(null,[!1])})},addShareOfType:function(n,i,r){t(document).one("facebook:connect",function(t,e,s,a){s&&a?o(n,!0,i,r):r()}),e.Facebook.login("publish_actions",null)},removeShareOfType:function(t,e,n){o(t,!1,e,n)}}}()))}(window.jQuery||window.Zepto,window.Etsy),"function"==typeof define&&define.amd&&define("common/etsy.facebook",[],function(){return window.Etsy.Facebook}),window.Etsy.loader.loaded("common/etsy.facebook.20140703190110.js"),function(t,e){function n(t){return function(){var n={php_event_name:"share_facebook",button_name:t};r&&(n.source=r),s&&(n.post_to_page=s),e.EventLogger.logEvent(n)}}if(!e.Facebook||!e.Facebook.likeButtonInitialized){var i=t("fb\\:like"),r=i.data("share_from"),s=i.data("fb_page_url");e.Facebook.load(function(){e.Facebook.eventSubscribe("edge.create",n("like")),e.Facebook.eventSubscribe("message.send",n("send")),r&&"listing"==r&&e.Context.data.listingId&&e.Facebook.eventSubscribe("edge.create",function(){jQuery.ajax({type:"post",url:"/api/v2/ajax/track-stats/shared_listing_facebook/"+e.Context.data.listingId,data:{_nnc:e.csrf_nonce},dataType:"json"})}),e.Facebook.likeButtonInitialized=!0})}}(window.jQuery||window.Zepto,window.Etsy);